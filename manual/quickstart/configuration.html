<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating a Configuration Package &mdash; ros2_canopen 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Starting a Configuration Package" href="operation.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> ros2_canopen
            <img src="../_static/ros2-canopen-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating a Configuration Package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#package-creation">Package creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bus-configuration-creation">Bus configuration creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#launch-configuration-creation">Launch configuration creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cmake-configuration-creation">CMAKE Configuration creation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="operation.html">Starting a Configuration Package</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/configuration/configuration.html">Bus Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/operation/operation.html">Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/operation/service-interface.html">Service Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/operation/managed-service-interface.html">Managed Service Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/operation/ros2-control-interface.html">ROS2 Control System Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/master.html">Master Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/proxy-driver.html">Proxy Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/cia402-driver.html">Cia402 Driver</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developers-guide/design-objectives.html">Design Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers-guide/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers-guide/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers-guide/new-driver.html">Creating a new device driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers-guide/new-master.html">Creating a new master</a></li>
<li class="toctree-l1"><a class="reference external" href="https://ros-industrial.github.io/ros2_canopen/api/">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Tests</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../software-tests/proxy-driver-test.html">Lifecycle Proxy Driver Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software-tests/proxy-driver-test.html#proxy-driver-test">Proxy Driver Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software-tests/ros2_control_system-test.html">ros2_control SystemInterface test</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ros2_canopen</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Creating a Configuration Package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/quickstart/configuration.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-a-configuration-package">
<h1>Creating a Configuration Package<a class="headerlink" href="#creating-a-configuration-package" title="Permalink to this headline"></a></h1>
<p>In order to use the ros2_canopen stack for your robot, you need to
create a configuration package, that holds the configuration of the
bus as well as you launch script. The following sections detail the
steps to create such a package.</p>
<section id="package-creation">
<h2>Package creation<a class="headerlink" href="#package-creation" title="Permalink to this headline"></a></h2>
<p>When you create your package, you have to first make some decisions.
You will need to choose a package name, decide which bus configurations
you need to have (usually one per CAN interface) and which slaves you have.</p>
<div class="line-block">
<div class="line"><strong>package_name</strong>: Name of the package</div>
<div class="line"><strong>bus_config_name</strong>: Name of the the bus configuration (you can have multiple)</div>
</div>
<p>You can use <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">pkg</span> <span class="pre">create</span></code> command to create your package.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ros2<span class="w"> </span>pkg<span class="w"> </span>create<span class="w"> </span>--dependencies<span class="w"> </span>ros2_canopen<span class="w"> </span>lely_core_libraries<span class="w"> </span>--build-type<span class="w"> </span>ament_cmake<span class="w"> </span><span class="o">{</span>package_name<span class="o">}</span>
<span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="o">{</span>package_name<span class="o">}</span>
<span class="gp">$ </span>rm<span class="w"> </span>-rf<span class="w"> </span>src
<span class="gp">$ </span>rm<span class="w"> </span>-rf<span class="w"> </span>include
<span class="gp">$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span>launch
<span class="gp">$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span>config
</pre></div>
</div>
<p>Now your package directory should look like this.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>{package_name}
├── config
├── launch
├── CMakeLists.txt
└── package.xml
</pre></div>
</div>
</section>
<section id="bus-configuration-creation">
<h2>Bus configuration creation<a class="headerlink" href="#bus-configuration-creation" title="Permalink to this headline"></a></h2>
<ol class="arabic">
<li><dl>
<dt><strong>Bus configuration decisions</strong></dt><dd><p>Decide how many bus configurations you need. Add one subfolder for each
bus configuration in your <cite>config</cite>-folder.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="o">{</span>bus_config_name<span class="o">}</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><strong>Add device information to bus configurations</strong></dt><dd><p>Once you created the folders for your bus configurations add the .eds files
for the devices that are in the bus configuration to the respective folder.</p>
<p>Now your package directory should now look like this.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>{package_name}
├── config
│   ├── {bus_config_name_1}
│   |   ├── {device1}.eds
│   |   ├── {device...}.eds
│   |   └── {slave_n}.eds
│   └── {bus_config_name_2}
│       ├── {device1}.eds
│       ├── {device...}.eds
│       └── {slave_n}.eds
├── CMakeLists.txt
└── package.xml
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><strong>Create the bus configuration specifications</strong></dt><dd><p>To specify the bus configuration ros2_canopen uses the a YAML-file called
bus.yml. Create the file in the respective bus configuration folder.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>touch<span class="w"> </span>bus.yml
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>{package_name}
├── config
│   ├── {bus_config_name_1}
│   |   ├── bus.yml
│   |   ├── {device1}.eds
│   |   ├── {device...}.eds
│   |   └── {slave_n}.eds
│   └── {bus_config_name_2}
│       ├── bus.yml
│       ├── {device1}.eds
│       ├── {device...}.eds
│       └── {slave_n}.eds
├── CMakeLists.txt
└── package.xml
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><strong>Edit the bus configuration specifications</strong></dt><dd><p>You need to modify each bus.yml file according to your needs.
First you need to define where these files and generated files will be
found at runtime. This is usually the following if you use colcon to
build from source.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">options</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dcf_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install/{package_name}/share/{package_name}/config/{bus_config_name}</span>
</pre></div>
</div>
<p>Then you need to define your master.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">master</span><span class="p">:</span>
<span class="w">  </span><span class="nt">node_id</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">node id</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ros2 package where to find the master driver (usually canopen_core)</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">component type of the driver (ros2_canopen</span><span class="p p-Indicator">::</span><span class="nv">MasterDriver or ros2_canopen</span><span class="p p-Indicator">::</span><span class="nv">LifecycleMasterDriver)</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>Make sure, that you specify a lifecycle master if you use the lifecycled version of ros2_canopen.
And add other configuration data as necessary. A documentation of configuration options
available can be found in the <a class="reference internal" href="#"><span class="doc">Creating a Configuration Package</span></a> documentation.</p>
<p>Once you have defined the configuration of your master, add your slaves. The following
describes the mandatory data per slave. Further configuration options can be found in the <a class="reference internal" href="#"><span class="doc">Creating a Configuration Package</span></a> documentation.
The slave name is the node name that will be assigned to the driver.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">[</span><span class="nv">unique slave name</span><span class="p p-Indicator">]:</span>
<span class="w">  </span><span class="nt">node_id</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">node id</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ros2 package where to find the driver</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">qualified name of the driver</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>Make sure you use a lifecycle slave if you use the lifecycled version of ros2_canopen.</p>
</dd>
</dl>
</li>
</ol>
</section>
<section id="launch-configuration-creation">
<h2>Launch configuration creation<a class="headerlink" href="#launch-configuration-creation" title="Permalink to this headline"></a></h2>
<p>Create a launch folder in your package directory and a launch file.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir launch</span>
<span class="go">touch {...}.launch.py</span>
</pre></div>
</div>
<p>Add the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
<span class="w">      </span><span class="sd">&quot;&quot;&quot;Generate launch description with multiple components.&quot;&quot;&quot;</span>
      <span class="n">path_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>

      <span class="n">ld</span> <span class="o">=</span> <span class="n">launch</span><span class="o">.</span><span class="n">LaunchDescription</span><span class="p">()</span>


      <span class="n">device_container</span> <span class="o">=</span> <span class="n">IncludeLaunchDescription</span><span class="p">(</span>
          <span class="n">PythonLaunchDescriptionSource</span><span class="p">(</span>
              <span class="p">[</span>
                  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_package_share_directory</span><span class="p">(</span><span class="s2">&quot;canopen_core&quot;</span><span class="p">),</span> <span class="s2">&quot;launch&quot;</span><span class="p">),</span>
                  <span class="s2">&quot;/canopen.launch.py&quot;</span><span class="p">,</span>
              <span class="p">]</span>
          <span class="p">),</span>
          <span class="n">launch_arguments</span><span class="o">=</span><span class="p">{</span>
              <span class="s2">&quot;master_config&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                  <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{package_name}</span><span class="s2">&quot;</span><span class="p">),</span>
                  <span class="s2">&quot;config&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;</span><span class="si">{bus_config_name}</span><span class="s2">&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;master.dcf&quot;</span><span class="p">,</span>
              <span class="p">),</span>
              <span class="s2">&quot;master_bin&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                  <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{package_name}</span><span class="s2">&quot;</span><span class="p">),</span>
                  <span class="s2">&quot;config&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;</span><span class="si">{bus_config_name}</span><span class="s2">&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;master.bin&quot;</span><span class="p">,</span>
              <span class="p">),</span>
              <span class="s2">&quot;bus_config&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                  <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{package_name}</span><span class="s2">&quot;</span><span class="p">),</span>
                  <span class="s2">&quot;config&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;</span><span class="si">{bus_config_name}</span><span class="s2">&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;bus.yml&quot;</span><span class="p">,</span>
              <span class="p">),</span>
              <span class="s2">&quot;can_interface_name&quot;</span><span class="p">:</span> <span class="s2">&quot;{can_interface i.e. can0}&quot;</span><span class="p">,</span>
          <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>

      <span class="p">)</span>

      <span class="n">ld</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span><span class="n">device_container</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">ld</span>
</pre></div>
</div>
</section>
<section id="cmake-configuration-creation">
<h2>CMAKE Configuration creation<a class="headerlink" href="#cmake-configuration-creation" title="Permalink to this headline"></a></h2>
<p>Finally we need to adjust the CMakeLists.txt file to pick everything up correctly.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.8</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">{package_name}</span><span class="p">)</span>

<span class="nb">if</span><span class="p">(</span><span class="s">CMAKE_COMPILER_IS_GNUCXX</span><span class="w"> </span><span class="s">OR</span><span class="w"> </span><span class="s">CMAKE_CXX_COMPILER_ID</span><span class="w"> </span><span class="s">MATCHES</span><span class="w"> </span><span class="s2">&quot;Clang&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nb">add_compile_options</span><span class="p">(</span><span class="s">-Wall</span><span class="w"> </span><span class="s">-Wextra</span><span class="w"> </span><span class="s">-Wpedantic</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c"># find dependencies</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">ament_cmake</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">canopen_core</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">canopen_interfaces</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">canopen_base_driver</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">canopen_proxy_driver</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">lely_core_libraries</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>


<span class="nb">generate_dcf</span><span class="p">(</span><span class="s">{bus_config_name}</span><span class="p">)</span>

<span class="nb">install</span><span class="p">(</span><span class="s">DIRECTORY</span>
<span class="w">  </span><span class="s">launch/</span>
<span class="w">  </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">share/</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="s">/launch/</span>
<span class="p">)</span>

<span class="nb">install</span><span class="p">(</span><span class="s">DIRECTORY</span>
<span class="w">  </span><span class="s">launch_tests/</span>
<span class="w">  </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">share/</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="s">/launch_tests/</span>
<span class="p">)</span>


<span class="nb">if</span><span class="p">(</span><span class="s">BUILD_TESTING</span><span class="p">)</span>
<span class="w">  </span><span class="nb">find_package</span><span class="p">(</span><span class="s">ament_lint_auto</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="w">  </span><span class="c"># the following line skips the linter which checks for copyrights</span>
<span class="w">  </span><span class="c"># comment the line when a copyright and license is added to all source files</span>
<span class="w">  </span><span class="nb">set</span><span class="p">(</span><span class="s">ament_cmake_copyright_FOUND</span><span class="w"> </span><span class="s">TRUE</span><span class="p">)</span>
<span class="w">  </span><span class="c"># the following line skips cpplint (only works in a git repo)</span>
<span class="w">  </span><span class="c"># comment the line when this package is in a git repo and when</span>
<span class="w">  </span><span class="c"># a copyright and license is added to all source files</span>
<span class="w">  </span><span class="nb">set</span><span class="p">(</span><span class="s">ament_cmake_cpplint_FOUND</span><span class="w"> </span><span class="s">TRUE</span><span class="p">)</span>
<span class="w">  </span><span class="nb">ament_lint_auto_find_test_dependencies</span><span class="p">()</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="nb">ament_package</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="operation.html" class="btn btn-neutral float-right" title="Starting a Configuration Package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Christoph Hellmann Santos,  Harshavardhan Deshpande.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>